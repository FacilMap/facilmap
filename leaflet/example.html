<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>facilmap-leaflet Example</title>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
		<style type="text/css">
			html, body { width: 100%; height: 100%; margin: 0; }
			body { display: flex; flex-direction: column; }
			#map { flex-grow: 1; }
		</style>
		<script>
			function log(name) {
				return (...args) => { console.log(name, ...args); };
			}
		</script>
	</head>

	<body>
		<div style="padding: 10px;">
			<input
				type="button"
				value="Click listener"
				onclick="L.FacilMap.ClickListener.addClickListener(map, log('click'), log('move'))"
			/>

			<input
				type="button"
				value="Default view"
				onclick="L.FacilMap.Views.displayView(map)"
			/>

			<input
				type="button"
				value="Hamburg"
				onclick="L.FacilMap.Views.displayView(map, { top: 53.959, left: 8.331, right: 9.650, bottom: 53.767, baseLayer: 'MpnW', layers: ['FrTo'] })"
			/>

			<input
				type="button"
				value="Open map wqxygV4R506PlBlZ"
				onclick="client.setPadId('wqxygV4R506PlBlZ').catch(log('setPadId error'))"
			/>
			<a href="http://localhost:40829/wqxygV4R506PlBlZ" target="_blank"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQElEQVR42qXKwQkAIAxDUUdxtO6/RBQkQZvSi8I/pL4BoGw/XPkh4XigPmsUgh0626AjRsgxHTkUThsG2T/sIlzdTsp52kSS1wAAAABJRU5ErkJggg=="></a>

			<input
				type="button"
				value="Toggle filter name ~= &quot;test&quot;"
				onclick="map.setFmFilter(map.fmFilter ? undefined : 'name ~= &quot;test&quot;')"
			/>

			<input
				type="button"
				value="Berlin to Hamburg"
				onclick="client.setRoute({ routePoints: [{ lat: 52.51704, lon: 13.38886 }, { lat: 53.55034, lon: 10.00065 }], mode: 'car' })"
			/>
			<input
				type="button"
				value="Clear route"
				onclick="client.clearRoute()"
			/>

			<input
				type="button"
				value="Search for &quot;Berlin&quot;"
				onclick="client.find({ query: 'Berlin' }).then((res) => { searchResultsLayer.setResults(res) }).catch((err) => { console.error(err); })"
			/>
			<input
				type="button"
				value="Clear search"
				onclick="searchResultsLayer.setResults([]);"
			/>
		</div>
		<div id="map"></div>
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
		<script type="text/javascript" src="dist/facilmap-leaflet.js"></script>

		<script type="text/javascript">
		    var map = L.map('map',{
				center: [0,0],
				zoom: 5,
			});

			var client = new L.FacilMap.Socket("http://localhost:40829/");

			L.FacilMap.Layers.setVisibleLayers(map);
			
			L.control.layers(L.FacilMap.Layers.baseLayers, L.FacilMap.Layers.overlays).addTo(map);

			new L.FacilMap.BboxHandler(map, client).enable();

			const markersLayer = new L.FacilMap.MarkersLayer(client).addTo(map)
				.on("click", (e) => {
					markersLayer.setHighlightedMarkers(new Set([e.layer.marker.id]));
					linesLayer.setHighlightedLines(new Set());
					searchResultsLayer.setHighlightedResults(new Set());
				});
			
			const linesLayer = new L.FacilMap.LinesLayer(client).addTo(map)
				.on("click", (e) => {
					L.DomEvent.stopPropagation(e);
					markersLayer.setHighlightedMarkers(new Set());
					linesLayer.setHighlightedLines(new Set([e.layer.line.id]));
					searchResultsLayer.setHighlightedResults(new Set());
				});
			
			map.on("click", () => {
				markersLayer.setHighlightedMarkers(new Set());
				linesLayer.setHighlightedLines(new Set());
				searchResultsLayer.setHighlightedResults(new Set());
			});

			const routeLayer = new L.FacilMap.RouteLayer(client, { raised: true }).addTo(map);

			const searchResultsLayer = new L.FacilMap.SearchResultsLayer().addTo(map)
				.on("click", (e) => {
					L.DomEvent.stopPropagation(e);
					markersLayer.setHighlightedMarkers(new Set());
					linesLayer.setHighlightedLines(new Set());
					searchResultsLayer.setHighlightedResults(new Set([ e.layer._fmSearchResult ]));
				});

			const hashHandler = new L.FacilMap.HashHandler(map, client).enable();
		</script>
	</body>
</html>
